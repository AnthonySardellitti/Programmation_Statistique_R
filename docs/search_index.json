[
["chaines.html", "Chapitre 10 Manipuler le texte et les dates 10.1 Manipulation des chaînes de caractères 10.2 Manipulation des dates", " Chapitre 10 Manipuler le texte et les dates 10.1 Manipulation des chaînes de caractères La manipulation des chaines de caractères est essentielle dans le traitement des données. On peut trouver des données textuelles sur réseaux sociaux par exemple. La plupart du temps, ces données sont brutes et il faut donc manipuler le texte pour en extraire les informations importantes. Pour manipuler des chaines de caractères, il faut bien entendu que les données soit de type caractère. On peut vérifier cela avec la fonction class() et as.character() si une conversion est nécessaire. x &lt;- c(&quot;Luca&quot;,&quot;Ambra&quot;,&quot;Francesco&quot;) class(x) ## [1] &quot;character&quot; 10.1.1 Concaténer des chaînes La fonction paste() permet de concaténer des chaînes de caractères. paste(c(&quot;Hello&quot;), c(&quot;Luca&quot;,&quot;Ambra&quot;,&quot;Francesco&quot;), sep = &quot;_&quot;) ## [1] &quot;Hello_Luca&quot; &quot;Hello_Ambra&quot; &quot;Hello_Francesco&quot; Ici, on profite du phénomène de réplication de R pour éviter de répéter le premier vecteur. On peut aussi utiliser la fonction cat() qui à le même rôle que la fonction print(). cat(&quot;Bonjour&quot;, &quot;\\n&quot; ,&quot;Une nouvelle ligne&quot;,&quot;\\n&quot; ,&quot;\\t&quot;, &quot;une tabulation&quot;, &quot;\\n&quot;, &quot;\\&quot;&quot;, &quot;une expression entre guillemets&quot;,&quot;\\&quot;&quot;) ## Bonjour ## Une nouvelle ligne ## une tabulation ## &quot; une expression entre guillemets &quot; Des caractères d’échapement sont présents dans l’exemple précédent. On peut en recontrer d’autres mais les plus fréquents sont le retour à la ligne \\n, souvent utilisé dans des titres de graphique et la tabulation \\t permettant notament d’importer des données quand le séparateur correspond à ce dernier. 10.1.2 Majuscule et minuscule Les fonctions toupper() et toloweer() permettent de modifier la casse. Rappelons que le langage R en est sensible tout comme la plupart des langages de programmation. toupper(x) ## [1] &quot;LUCA&quot; &quot;AMBRA&quot; &quot;FRANCESCO&quot; tolower(x) ## [1] &quot;luca&quot; &quot;ambra&quot; &quot;francesco&quot; 10.1.3 Longueur d’une chaîne On peut utiliser la fonction nchar() pour compter la longueur d’une chaîne. Attention, l’espace est considéré comme un caractère. nchar(x) ## [1] 4 5 9 10.1.4 Extraction de sous-chaînes La fonction substr() permet d’extraire certains élèments d’une chaîne de caractère à partir de leur position. substr(x,start = 1,stop = 3) ## [1] &quot;Luc&quot; &quot;Amb&quot; &quot;Fra&quot; Pour extraire la fin d’une chaîne de catactère, il est recommandé d’utiliser le package stringr avec la fonction str_sub(). library(stringr) str_sub(string = x,start = -3,end = -1) ## [1] &quot;uca&quot; &quot;bra&quot; &quot;sco&quot; 10.1.5 Remplacement de chaînes La fonction gsub() permet de remplacer un motif recherché par une autre chaîne de caractère. x &lt;- paste(c(&quot;Hello&quot;), c(&quot;Luca&quot;,&quot;Ambra&quot;,&quot;Francesco&quot;), sep = &quot;_&quot;) x ## [1] &quot;Hello_Luca&quot; &quot;Hello_Ambra&quot; &quot;Hello_Francesco&quot; x &lt;- gsub(pattern = &quot;_&quot;,replacement = &quot; &quot;,x) x ## [1] &quot;Hello Luca&quot; &quot;Hello Ambra&quot; &quot;Hello Francesco&quot; 10.1.6 Décomposition d’une chaîne On utilise la fonction strsplit() pour décomposer une chaîne de caractère selon un motif. Le résultat renvoyé est une liste. strsplit(x,split = &quot; &quot;) ## [[1]] ## [1] &quot;Hello&quot; &quot;Luca&quot; ## ## [[2]] ## [1] &quot;Hello&quot; &quot;Ambra&quot; ## ## [[3]] ## [1] &quot;Hello&quot; &quot;Francesco&quot; 10.1.7 Recherche de sous-chaîne La fonction grep() permet de rechercher les élèments d’un vecteur composé du motif. x ## [1] &quot;Hello Luca&quot; &quot;Hello Ambra&quot; &quot;Hello Francesco&quot; grep(pattern = &quot;Am&quot;, x) ## [1] 2 10.1.8 Aller plus loin Les fonctions que propose le package base permettent de couvrir l’essentiel des méthodes de traitement de texte. Néanmoins, le package stringr de la suite tidyverse propose des fonctionnalités bien plus avancées. Julien Barnier en propose une immersion dans son tutoriel (vers le tutoriel). Il est possible d’utiliser des expressions régulières lorsqu’on utilise des fonctions de traitements de texte. Ricco Rakotomalala en propose d’ailleurs une esquisse dans son tutoriel. Voici un petit exemple de vérification d’adresse mail à partir d’une expression régulière : emails &lt;- c(&quot;steve_aoki@gmail.com&quot;, &quot;@jdoreofficiel&quot;, &quot;castex_jean@gouv.fr&quot;) regex &lt;- &quot;^[[:alnum:].-_]+@[[:alnum:].-]+$&quot; stringr::str_match(emails, regex) ## [,1] ## [1,] &quot;steve_aoki@gmail.com&quot; ## [2,] NA ## [3,] &quot;castex_jean@gouv.fr&quot; 10.2 Manipulation des dates 10.2.1 Les dates Les dates sont stockées comme le nombre de jours depuis 1970-01-01, avec des valeurs négatives pour les dates antérieures. Par défaut, R reconnait le format date si la chaîne de caractère est sous la forme yyyy-mm-dd. Néanmoins, lorsque ce n’est pas le cas on utilsie la fonction as.Date() qui convertit une chaîne de caractères en date. d &lt;- as.Date(&quot;2018-07-15&quot;) class(d) ## [1] &quot;Date&quot; unclass(d) ## [1] 17727 Dans l’exemple ci-dessus, cela fonctionne très bien car la chaîne de caractère correspond parfaitement au format interpréter par défaut de R. Lorsque ce n’est pas le cas, il faut indiquer à R comment interpréter la chaîne de caractère en tant que date. On utilise la table de référence présente dans l’aide en executant la commande help(strptime). d &lt;- as.Date(&quot;2018 15 07&quot;, format = (&quot;%Y %d %m&quot;)) d ## [1] &quot;2018-07-15&quot; d &lt;- as.Date(&quot;15 Juillet, 2018&quot;, format = (&quot;%d %B, %Y&quot;)) d ## [1] &quot;2018-07-15&quot; Voici un tableau récapitulatif : Ce tableau permet donc également de gérer le temps (heures, minutes, secondes) quand ces valeurs sont renseignées dans une chaîne de caractères. 10.2.2 L’horloge Le classe POSIXct est une des classes date pouvant gérer la date et l’horloge. Cette classe stocke les dates en secondes depuis 1970-01-01 01:00:00 d &lt;- as.POSIXct(&quot;2018-07-15 19:00:00&quot;) unclass(d) ## [1] 1531674000 ## attr(,&quot;tzone&quot;) ## [1] &quot;&quot; unclass(as.POSIXct(&quot;1970-01-01 01:00:00&quot;)) ## [1] 0 ## attr(,&quot;tzone&quot;) ## [1] &quot;&quot; La classe POSIXlt stocke la date et l’horloge sous forme de liste dont les éléments correspondent. Attention, ici l’année de référence semble être l’année 1900. d &lt;- as.POSIXlt(&quot;2018-07-15 19:00:00&quot;) unlist(unclass(d)) ## sec min hour mday mon year wday yday isdst zone ## &quot;0&quot; &quot;0&quot; &quot;19&quot; &quot;15&quot; &quot;6&quot; &quot;118&quot; &quot;0&quot; &quot;195&quot; &quot;1&quot; &quot;CEST&quot; ## gmtoff ## NA d$hour ## [1] 19 d$year ## [1] 118 Dans le cas où la chaîne de caractère ne respectère pas le format par défaut. On utilise le même procédé que pour la classe date. d &lt;- as.POSIXct(&quot;2018 15 07 190000&quot;, format = (&quot;%Y %d %m %H%M%S&quot;)) d ## [1] &quot;2018-07-15 19:00:00 CEST&quot; d &lt;- as.POSIXlt(&quot;15 Juillet, 2018 à 19h00 et 00s&quot;, format = (&quot;%d %B, %Y à %Hh%M et %Ss&quot;)) d ## [1] &quot;2018-07-15 19:00:00 CEST&quot; 10.2.3 Calcul sur les dates La fonction difftime() permet de calculer une différence entre deux dates. On peut s’en servir par exemple pour calculer un temps d’execution d’un programme. help(difftime) debut &lt;- Sys.time() Sys.sleep(5) fin &lt;- Sys.time() difftime(time1 = fin, time2 = debut,units = &quot;secs&quot;) ## Time difference of 5.006683 secs 10.2.4 Aller plus loin Le package lubridate propose des fonctionnalités plus avancées pour la manipulation des dates et des calendrier que ne savent pas gérer les fonctions par défaut de R. "]
]
